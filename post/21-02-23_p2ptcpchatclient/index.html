<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Breaking Down the Code; Creating a P2P Chat Client with C++ and QTNetwork. -</title><meta name=description content="In this blog post, we&rsquo;ll explore how to create a peer-to-peer chat client using C++ and QTNetwork. This chat client allows users to connect with each other using the TCP protocol, communicate through sending and receiving messages, and receive a list of connected peers on first connect. The chat client is designed to be extensible, with new peers being added dynamically, and with the ability to send and receive messages to and from all connected peers."><meta name=author content="Axel Vanherle"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Axel Vanherle","url":"https:\/\/axelvanherle.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/axelvanherle.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/axelvanherle.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/axelvanherle.github.io\/post\/21-02-23_p2ptcpchatclient\/","name":"Breaking down the code; creating a p2 p chat client with c and qtnetwork."}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Axel Vanherle"},"headline":"Breaking Down the Code; Creating a P2P Chat Client with C\u002b\u002b and QTNetwork.","description":"In this blog post, we\u0026rsquo;ll explore how to create a peer-to-peer chat client using C\u002b\u002b and QTNetwork. This chat client allows users to connect with each other using the TCP protocol, communicate through sending and receiving messages, and receive a list of connected peers on first connect. The chat client is designed to be extensible, with new peers being added dynamically, and with the ability to send and receive messages to and from all connected peers.","inLanguage":"en","wordCount":2404,"datePublished":"2023-02-21T00:00:00","dateModified":"2023-02-21T00:00:00","image":"https:\/\/axelvanherle.github.io\/img\/icon.png","keywords":["programing, howto, story"],"mainEntityOfPage":"https:\/\/axelvanherle.github.io\/post\/21-02-23_p2ptcpchatclient\/","publisher":{"@type":"Organization","name":"https:\/\/axelvanherle.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/axelvanherle.github.io\/img\/icon.png","height":60,"width":60}}}</script><meta property="og:title" content="Breaking Down the Code; Creating a P2P Chat Client with C++ and QTNetwork."><meta property="og:description" content="In this blog post, we&rsquo;ll explore how to create a peer-to-peer chat client using C++ and QTNetwork. This chat client allows users to connect with each other using the TCP protocol, communicate through sending and receiving messages, and receive a list of connected peers on first connect. The chat client is designed to be extensible, with new peers being added dynamically, and with the ability to send and receive messages to and from all connected peers."><meta property="og:image" content="https://axelvanherle.github.io/img/icon.png"><meta property="og:url" content="https://axelvanherle.github.io/post/21-02-23_p2ptcpchatclient/"><meta property="og:type" content="website"><meta property="og:site_name" content="Axel Vanherle"><meta name=twitter:title content="Breaking Down the Code; Creating a P2P Chat Client with C++ and …"><meta name=twitter:description content="In this blog post, we&rsquo;ll explore how to create a peer-to-peer chat client using C++ and QTNetwork. This chat client allows users to connect with each other using the TCP protocol, communicate …"><meta name=twitter:image content="https://axelvanherle.github.io/img/icon.png"><meta name=twitter:card content="summary_large_image"><link href=https://axelvanherle.github.io/img/favicon.png rel=icon type=image/x-icon><meta name=generator content="Hugo 0.101.0"><link rel=alternate href=https://axelvanherle.github.io/index.xml type=application/rss+xml title="Axel Vanherle"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://axelvanherle.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://axelvanherle.github.io/css/highlight.min.css><link rel=stylesheet href=https://axelvanherle.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://axelvanherle.github.io/>Axel Vanherle</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li><a title=About href=/page/about/>About</a></li><li><a title=Archives href=/page/archive/>Archives</a></li><li><a title=Tags href=/tags>Tags</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Axel Vanherle" href=https://axelvanherle.github.io/><img class=avatar-img src=https://axelvanherle.github.io/img/icon.png alt="Axel Vanherle"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Breaking Down the Code; Creating a P2P Chat Client with C++ and QTNetwork.</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on February 21, 2023
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;12&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2404&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Axel Vanherle</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>In this blog post, we&rsquo;ll explore how to create a peer-to-peer chat client using C++ and QTNetwork. This chat client allows users to connect with each other using the TCP protocol, communicate through sending and receiving messages, and receive a list of connected peers on first connect. The chat client is designed to be extensible, with new peers being added dynamically, and with the ability to send and receive messages to and from all connected peers.</p><p>This was all done for the course in network programming, but I added some extra features that weren&rsquo;t required, leveling up my skills in Qt, so to speak.</p><p>But what was the challenge? Before I explain my code, I&rsquo;m going to talk about what the end result should&rsquo;ve been.</p><p>As part of their coursework, each student was required to create a TCP peer-to-peer chat client using C++ OOP style. This involved creating a chat client that could connect with one other peer, with the IP address provided as a command line argument. The first peer, however, did not require an argument. When a client first connects, the chat client needed to be able to receive a list of other peers from the first peer, and connect to these new peers. Finally, the chat client needed to be capable of sending and receiving messages to and from all other peers in the network. Overall, this project required students to demonstrate their understanding of fundamental concepts in network programming, as well as their ability to apply these concepts in a practical project.</p><p>If this is still not clear, have a look at this image. This explain the topology of a peer-to-peer network. Compare this to the topology of a regular chat service, where the server is responsible for sending and receiving all messages to and from clients.</p><table><thead><tr><th style=text-align:center>peer-to-peer</th><th style=text-align:center>server based</th></tr></thead><tbody><tr><td style=text-align:center><img src=/img/21-02-23_p2ptcpchatclient/P2P_network.png alt=p2pexample></td><td style=text-align:center><img src=/img/21-02-23_p2ptcpchatclient/Server_network.png alt=serverexample></td></tr></tbody></table><p>Now that you know what the project is about, I will explain my code and why I did certain things as best as I can. I will be using small code blocks, to explain my code in sections to make it easier to understand. Note that I am not writing this blog post to boast or even attempt to teach anyone anything. I simply enjoy writing and plan to maintain this blog, so I can look back on it in the future. If someone picks something up or learns something new, even better. To get a bigger picture of the entire project, head to the GitHub found <a href=https://github.com/axelvanherle/P2P-TCP-chatclient-NP>here</a>.</p><p>Let&rsquo;s start where the code starts, in the main. The entire <code>main.cpp</code> file can be found <a href=https://github.com/axelvanherle/P2P-TCP-chatclient-NP/blob/main/p2pchatclient/main.cpp>here</a>, I will be pulling code blocks from this and explaining it in more detail.</p><p>It starts with the includes. These are needed for the various functions i use later on. Most noteworthy are these;</p><ul><li><code>&lt;QObject></code>: This header is used for QObject, which is the base class for all Qt objects that can emit signals and slots.</li><li><code>&lt;QTcpSocket></code> and <code>&lt;QTcpServer></code>: These headers provide classes for creating TCP clients and servers, respectively, for network communication.</li><li><code>&lt;QAbstractSocket></code>: This header provides an abstract base class for all socket classes in Qt.</li><li><code>&lt;QDebug></code>: This header provides debugging and logging functionality.</li><li><code>&lt;QInputDialog></code>: This header provides a class for creating dialog boxes that prompt the user for input.</li><li><code>&lt;QApplication></code> and <code>&lt;QtWidgets></code>: These headers are used for creating GUI applications with Qt, including widgets and other graphical elements.</li></ul><p>For some reference, I will be explaining my code in this format;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>code here
</span></span></code></pre></div><p>Explanation here.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>QApplication</span> <span class=nf>a</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TcpClient</span> <span class=n>client</span><span class=p>;</span>
</span></span></code></pre></div><p>After the includes are done I initialize a Qt application using the <code>QApplication</code> class and creates an instance of it named <code>a</code>. The <code>TcpClient</code> object is then created using the default constructor.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>QLabel</span><span class=o>*</span> <span class=n>outputLabel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QLabel</span><span class=p>(</span><span class=s>&#34;Enter message:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>QLineEdit</span><span class=o>*</span> <span class=n>inputLineEdit</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QLineEdit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>QPushButton</span><span class=o>*</span> <span class=n>sendButton</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QPushButton</span><span class=p>(</span><span class=s>&#34;Send&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>QLabel</span><span class=o>*</span> <span class=n>inputLabel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QLabel</span><span class=p>(</span><span class=s>&#34;Received messages:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>QPlainTextEdit</span><span class=o>*</span> <span class=n>receivedTextEdit</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QPlainTextEdit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>receivedTextEdit</span><span class=o>-&gt;</span><span class=n>setReadOnly</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>receivedTextEdit</span><span class=o>-&gt;</span><span class=n>setMaximumBlockCount</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>QLabel</span><span class=o>*</span> <span class=n>debugLabel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QLabel</span><span class=p>(</span><span class=s>&#34;Debug messages:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>QPlainTextEdit</span><span class=o>*</span> <span class=n>debugTextEdit</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QPlainTextEdit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>debugTextEdit</span><span class=o>-&gt;</span><span class=n>setReadOnly</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>debugTextEdit</span><span class=o>-&gt;</span><span class=n>setMaximumHeight</span><span class=p>(</span><span class=mi>110</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>debugTextEdit</span><span class=o>-&gt;</span><span class=n>setMaximumBlockCount</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>debugTextEdit</span><span class=o>-&gt;</span><span class=n>setStyleSheet</span><span class=p>(</span><span class=s>&#34;color: red;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>QVBoxLayout</span><span class=o>*</span> <span class=n>layout</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QVBoxLayout</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>outputLabel</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>inputLineEdit</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>sendButton</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>inputLabel</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>receivedTextEdit</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>debugLabel</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>layout</span><span class=o>-&gt;</span><span class=n>addWidget</span><span class=p>(</span><span class=n>debugTextEdit</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>window</span><span class=p>.</span><span class=n>setLayout</span><span class=p>(</span><span class=n>layout</span><span class=p>);</span>
</span></span></code></pre></div><p>This code block creates a GUI with several widgets using the Qt library.</p><p>The widgets created are:</p><ul><li><code>outputLabel</code>: a <code>QLabel</code> widget with the text &ldquo;Enter message:&rdquo;</li><li><code>inputLineEdit</code>: a<code> QLineEdit</code> widget for the user to enter text</li><li><code>sendButton</code>: a <code>QPushButton</code> widget with the text &ldquo;Send&rdquo;</li><li><code>inputLabel</code>: a <code>QLabel</code> widget with the text &ldquo;Received messages:&rdquo;</li><li><code>receivedTextEdit</code>: a <code>QPlainTextEdit</code> widget for displaying received messages. It is set to read-only, has a maximum block count of 100, - and is able to display multiple lines of text.</li><li><code>debugLabel</code>: a <code>QLabel</code> widget with the text &ldquo;Debug messages:&rdquo;</li><li><code>debugTextEdit</code>: a <code>QPlainTextEdit</code> widget for displaying debug messages. It is set to read-only, has a maximum height of 110 pixels, has a maximum block count of 100, and is styled with red text.</li></ul><p>The widgets are then added to a <code>QVBoxLayout</code>, which is a vertical layout manager that arranges the widgets vertically. Finally, the layout is set as the layout for the window widget.</p><p>Here is how it looks;</p><table><thead><tr><th style=text-align:center>example 1</th><th style=text-align:center>example 2</th></tr></thead><tbody><tr><td style=text-align:center><img src=/img/21-02-23_p2ptcpchatclient/ex1.png alt=p2pexample></td><td style=text-align:center><img src=/img/21-02-23_p2ptcpchatclient/ex2.png alt=serverexample></td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>==</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span><span class=p>.</span><span class=n>firstConnect</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]));</span>
</span></span></code></pre></div><p>Then there&rsquo;s this part. It doesn&rsquo;t do much; it simply checks whether command line arguments have been passed. If they have, the <code>firstConnect</code> function is called.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>QObject</span><span class=o>::</span><span class=n>connect</span><span class=p>(</span><span class=o>&amp;</span><span class=n>client</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>TcpClient</span><span class=o>::</span><span class=n>newConnection</span><span class=p>,</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>QTcpSocket</span> <span class=o>*</span><span class=n>socket</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;New connection from: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>socket</span><span class=o>-&gt;</span><span class=n>peerAddress</span><span class=p>().</span><span class=n>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>debugTextEdit</span><span class=o>-&gt;</span><span class=n>appendPlainText</span><span class=p>(</span><span class=s>&#34;New connection from: &#34;</span> <span class=o>+</span> <span class=n>socket</span><span class=o>-&gt;</span><span class=n>peerAddress</span><span class=p>().</span><span class=n>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>QObject</span><span class=o>::</span><span class=n>connect</span><span class=p>(</span><span class=n>socket</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>QTcpSocket</span><span class=o>::</span><span class=n>readyRead</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>client</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>TcpClient</span><span class=o>::</span><span class=n>readFromAll</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This snippet creates a connection between a <code>QTcpSocket</code> and the <code>TcpClient</code> object. When a new connection is made, it prints the peer address and sets up a signal-slot connection to read incoming data from all connected sockets. The code is a lambda function that is executed when a new connection is made that takes a <code>QTcpSocket</code> pointer as its argument. This function first prints the peer address of the socket using <code>qDebug()</code>. It then appends the same information to the <code>debugTextEdit</code> using <code>appendPlainText()</code>. Finally, it sets up a signal-slot connection between the socket&rsquo;s <code>readyRead</code> signal and the <code>readFromAll</code> slot of the <code>TcpClient</code> object using the <code>QObject::connect()</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>QObject</span><span class=o>::</span><span class=n>connect</span><span class=p>(</span><span class=o>&amp;</span><span class=n>client</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>TcpClient</span><span class=o>::</span><span class=n>newMessageReceived</span><span class=p>,</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>QString</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;New message received: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>receivedTextEdit</span><span class=o>-&gt;</span><span class=n>appendPlainText</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This code uses a lambda function to connect the <code>newMessageReceived</code> signal of the <code>TcpClient</code> object to a slot. When a new message is received, the signal is emitted and the lambda function is called. The function then logs the received message using <code>qDebug</code> and appends it to the <code>receivedTextEdit</code> widget.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>QObject</span><span class=o>::</span><span class=n>connect</span><span class=p>(</span><span class=n>sendButton</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>QPushButton</span><span class=o>::</span><span class=n>clicked</span><span class=p>,</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>]()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QString</span> <span class=n>message</span> <span class=o>=</span> <span class=n>inputLineEdit</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=n>isEmpty</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Show message box with error
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>QMessageBox</span><span class=o>::</span><span class=n>warning</span><span class=p>(</span><span class=o>&amp;</span><span class=n>window</span><span class=p>,</span> <span class=s>&#34;Error&#34;</span><span class=p>,</span> <span class=s>&#34;Message cannot be empty!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Message sent: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>debugTextEdit</span><span class=o>-&gt;</span><span class=n>appendPlainText</span><span class=p>(</span><span class=s>&#34;Message sent: &#34;</span> <span class=o>+</span> <span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span><span class=p>.</span><span class=n>sendToAll</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>inputLineEdit</span><span class=o>-&gt;</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This is a lambda function that is used to connect the click signal of the <code>sendButton</code> to a slot that sends a message to all peers. When the <code>sendButton</code> is clicked, the function gets executed. It first retrieves the message entered by the user from the <code>inputLineEdit</code>, and checks if it is empty. If it is, it displays an error message using a <code>QMessageBox</code>. Otherwise, it logs the message to the <code>debugTextEdit</code>, sends it to all connected peers using the <code>sendToAll</code> function of the <code>TcpClient</code> object, and clears the <code>inputLineEdit</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>window</span><span class=p>.</span><span class=n>show</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>a</span><span class=p>.</span><span class=n>exec</span><span class=p>();</span>
</span></span></code></pre></div><p>And here we are, at the end of the main with the last two lines, but fear not; there is more. <code>window.show()</code> makes the window visible to the user. The second line <code>return a.exec()</code> starts the event loop of the Qt application, which waits for and processes events.</p><p>Now we move on to the <code>TcpClient</code> class. I will not be explaining the header file at all, since this is just the declaration of the functions, slots, etc. The header file can be found <a href=https://github.com/axelvanherle/P2P-TCP-chatclient-NP/blob/main/p2pchatclient/tcpclient.h>here</a> and the C++ file can be found <a href=https://github.com/axelvanherle/P2P-TCP-chatclient-NP/blob/main/p2pchatclient/tcpclient.cpp>here</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>TcpClient</span><span class=o>::</span><span class=n>TcpClient</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>QObject</span><span class=p>(</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create the server socket and listen for connections
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>server</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QTcpServer</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>connect</span><span class=p>(</span><span class=n>server</span><span class=p>,</span> <span class=n>SIGNAL</span><span class=p>(</span><span class=n>newConnection</span><span class=p>()),</span> <span class=k>this</span><span class=p>,</span> <span class=n>SLOT</span><span class=p>(</span><span class=n>handleNewConnection</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=o>-&gt;</span><span class=n>listen</span><span class=p>(</span><span class=n>QHostAddress</span><span class=o>::</span><span class=n>Any</span><span class=p>,</span> <span class=mi>24042</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This code snippet defines the constructor for the <code>TcpClient</code> class, which is a subclass of the <code>QObject</code> class. This initializes the server socket, connects the <code>newConnection()</code> signal to the <code>handleNewConnection()</code> slot to handle new connections (this is self-explanatory), and starts listening for incoming connections on a specified port number. This means that when a new connection is made, the <code>handleNewConnection()</code> slot will be called.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>TcpClient</span><span class=o>::</span><span class=n>handleNewConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QTcpSocket</span> <span class=o>*</span><span class=n>socket</span> <span class=o>=</span> <span class=n>server</span><span class=o>-&gt;</span><span class=n>nextPendingConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>peers</span> <span class=o>=</span> <span class=n>getPeers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>socket</span><span class=o>-&gt;</span><span class=n>write</span><span class=p>(</span><span class=n>peers</span><span class=p>.</span><span class=n>c_str</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>connect</span><span class=p>(</span><span class=n>socket</span><span class=p>,</span> <span class=n>SIGNAL</span><span class=p>(</span><span class=n>readyRead</span><span class=p>()),</span> <span class=k>this</span><span class=p>,</span> <span class=n>SLOT</span><span class=p>(</span><span class=n>readFromAll</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>    <span class=n>m_sockets</span><span class=p>.</span><span class=n>append</span><span class=p>(</span><span class=n>socket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=nf>newConnection</span><span class=p>(</span><span class=n>socket</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Here we define the <code>handleNewConnection()</code> slot. The purpose of this slot is to handle a new incoming connection from a client to the server. It also sends the list of currently connected peers to the new client using the <code>getPeers()</code> function, connects the <code>readyRead()</code> signal of the socket to the <code>readFromAll()</code> slot of the <code>TcpClient</code> object, adds the socket to the list of connected sockets, and emits a <code>newConnection()</code> signal to indicate that a new client has connected.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>TcpClient</span><span class=o>::</span><span class=n>sendToAll</span><span class=p>(</span><span class=n>QString</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>QTcpSocket</span> <span class=o>*</span><span class=nl>socket</span> <span class=p>:</span> <span class=n>m_sockets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>socket</span><span class=o>-&gt;</span><span class=n>write</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=n>toUtf8</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This code snippet defines the <code>sendToAll()</code> function. This function allows for the <code>TcpClient</code> object to send a message to all currently connected clients with a single call.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>TcpClient</span><span class=o>::</span><span class=n>readFromAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>QTcpSocket</span> <span class=o>*</span><span class=nl>socket</span> <span class=p>:</span> <span class=n>m_sockets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>socket</span><span class=o>-&gt;</span><span class=n>bytesAvailable</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>QString</span> <span class=n>message</span> <span class=o>=</span> <span class=n>QString</span><span class=o>::</span><span class=n>fromUtf8</span><span class=p>(</span><span class=n>socket</span><span class=o>-&gt;</span><span class=n>readAll</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=n>emit</span> <span class=nf>newMessageReceived</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This code snippet defines the <code>readFromAll()</code> slot for the class. The purpose of this slot is to read incoming data from all connected clients and emit a signal for each new message received. It uses a for each loop to iterate over the list of sockets, and check each one if there is data available to read. After reading, it converts it to a <code>QString</code> object, and emits a <code>newMessageReceived()</code> signal for each new message received.</p><p>Now here&rsquo;s a big boy code block, are you ready?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>TcpClient</span><span class=o>::</span><span class=n>firstConnect</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>firstIp</span><span class=p>,</span> <span class=kt>int</span> <span class=n>firstPort</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QTcpSocket</span> <span class=o>*</span><span class=n>firstSocket</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QTcpSocket</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get me a damn socket! Grrrr
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>firstSocket</span><span class=o>-&gt;</span><span class=n>connectToHost</span><span class=p>(</span><span class=n>firstIp</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span> <span class=n>firstPort</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>firstSocket</span><span class=o>-&gt;</span><span class=n>write</span><span class=p>(</span><span class=s>&#34;Hello there!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>firstSocket</span><span class=o>-&gt;</span><span class=n>waitForBytesWritten</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>firstSocket</span><span class=o>-&gt;</span><span class=n>waitForReadyRead</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>firstSocket</span><span class=o>-&gt;</span><span class=n>waitForConnected</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>connect</span><span class=p>(</span><span class=n>firstSocket</span><span class=p>,</span> <span class=n>SIGNAL</span><span class=p>(</span><span class=n>readyRead</span><span class=p>()),</span> <span class=k>this</span><span class=p>,</span> <span class=n>SLOT</span><span class=p>(</span><span class=n>readFromAll</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>        <span class=n>m_sockets</span><span class=p>.</span><span class=n>append</span><span class=p>(</span><span class=n>firstSocket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span> <span class=nf>newConnection</span><span class=p>(</span><span class=n>firstSocket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connected to: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>firstIp</span><span class=p>.</span><span class=n>c_str</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>firstSocket</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>recv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>recv</span> <span class=o>=</span> <span class=n>firstSocket</span><span class=o>-&gt;</span><span class=n>readAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Parse the received buffer filled with new IP and Ports.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>std</span><span class=o>::</span><span class=n>istringstream</span> <span class=n>ss</span><span class=p>(</span><span class=n>recv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>token</span><span class=p>,</span> <span class=n>newIP</span><span class=p>,</span> <span class=n>newPort</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>getline</span><span class=p>(</span><span class=n>ss</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span> <span class=c1>// discard first line
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>getline</span><span class=p>(</span><span class=n>ss</span><span class=p>,</span> <span class=n>token</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>stringstream</span> <span class=n>tokenStream</span><span class=p>(</span><span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>getline</span><span class=p>(</span><span class=n>tokenStream</span><span class=p>,</span> <span class=n>newIP</span><span class=p>,</span> <span class=sc>&#39;:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>getline</span><span class=p>(</span><span class=n>tokenStream</span><span class=p>,</span> <span class=n>newPort</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>QTcpSocket</span> <span class=o>*</span><span class=n>socket</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QTcpSocket</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>socket</span><span class=o>-&gt;</span><span class=n>connectToHost</span><span class=p>(</span><span class=n>newIP</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span> <span class=n>atoi</span><span class=p>(</span><span class=n>newPort</span><span class=p>.</span><span class=n>c_str</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>            <span class=n>socket</span><span class=o>-&gt;</span><span class=n>write</span><span class=p>(</span><span class=s>&#34;Hello there!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>socket</span><span class=o>-&gt;</span><span class=n>waitForBytesWritten</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>socket</span><span class=o>-&gt;</span><span class=n>waitForReadyRead</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>temp</span> <span class=o>=</span> <span class=n>socket</span><span class=o>-&gt;</span><span class=n>readAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Are we connected?
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>socket</span><span class=o>-&gt;</span><span class=n>state</span><span class=p>()</span> <span class=o>==</span> <span class=n>QAbstractSocket</span><span class=o>::</span><span class=n>ConnectedState</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Connected to &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>newIP</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>newPort</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; successfully!&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>connect</span><span class=p>(</span><span class=n>socket</span><span class=p>,</span> <span class=n>SIGNAL</span><span class=p>(</span><span class=n>readyRead</span><span class=p>()),</span> <span class=k>this</span><span class=p>,</span> <span class=n>SLOT</span><span class=p>(</span><span class=n>readFromAll</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>                <span class=n>m_sockets</span><span class=p>.</span><span class=n>append</span><span class=p>(</span><span class=n>socket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>emit</span> <span class=nf>newConnection</span><span class=p>(</span><span class=n>socket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Failed to connect to &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>newIP</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>newPort</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Failed to connect to: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>firstIp</span><span class=p>.</span><span class=n>c_str</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>firstSocket</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This code defines the <code>firstConnect()</code> function that connects to a peer with the specified IP address and port number. It sends a <code>"Hello there!"</code> message to the peer, waits for a response and if the connection is successful, the function reads the response using the <code>readAll()</code> function, which returns the response as a string. It then parses this string to extract new IP addresses and port numbers using a <code>std::istringstream</code> object and a <code>getline()</code> function. It then connects to each of these new peers in turn, sending another <code>"Hello there!"</code> message and waiting for a response before adding them to the list of connected sockets. If the connection is successful, the function emits a <code>newConnection()</code> signal, adds the new socket to the list of connected sockets using the <code>append()</code> function, and connects the <code>readyRead()</code> signal of the new socket to the <code>readFromAll()</code> slot using the <code>connect()</code> function. If the connection fails, the function prints an error message to the console.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>TcpClient</span><span class=o>::</span><span class=n>getPeers</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QString</span> <span class=n>peerList</span> <span class=o>=</span> <span class=s>&#34;NEWCON&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>peerList</span> <span class=o>+=</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>QTcpSocket</span> <span class=o>*</span><span class=nl>socket</span> <span class=p>:</span> <span class=n>m_sockets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>socket</span><span class=o>-&gt;</span><span class=n>state</span><span class=p>()</span><span class=o>==</span> <span class=n>QTcpSocket</span><span class=o>::</span><span class=n>ConnectedState</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>QString</span> <span class=n>address</span> <span class=o>=</span> <span class=n>QHostAddress</span><span class=p>(</span><span class=n>socket</span><span class=o>-&gt;</span><span class=n>peerAddress</span><span class=p>().</span><span class=n>toIPv4Address</span><span class=p>()).</span><span class=n>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>peerList</span> <span class=o>+=</span> <span class=n>address</span> <span class=o>+</span> <span class=s>&#34;:&#34;</span> <span class=o>+</span> <span class=s>&#34;24042&#34;</span> <span class=o>+</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>temp</span> <span class=o>=</span> <span class=n>peerList</span><span class=p>.</span><span class=n>toStdString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This function returns a list of peers connected to the <code>TcpClient</code> object as a string. The function first initializes the <code>peerList</code> variable with the string <code>"NEWCON"</code> followed by a newline character. Then, it loops through each socket in the <code>m_sockets</code> list and checks if it is in a connected state using the <code>QTcpSocket::state()</code> function. If the socket is connected, it retrieves the IP address of the peer using <code>socket->peerAddress().toIPv4Address()</code> and converts it to a <code>QString</code>. It then appends the IP address, followed by the string <code>":24042"</code> and a newline character, to the <code>peerList</code> variable. Finally, the function converts the variable to a <code>std::string</code> and returns it, for other functions to call and use.</p><p>In conclusion, I found this project to be very enjoyable and challenging. I had never worked with QT or C++ in this way before, so it&rsquo;s safe to say that it has leveled up my skills. This was similar to what happened last year in the networking course when I worked with C, which gave me a better understanding of C itself. It turns out that OOP is not such a bad thing after all, who would&rsquo;ve though? This project also gave me a better appreciation for QT. At the beginning of the project, I wanted to switch to Berkeley sockets like I was used to in C, but I ended up persevering and it was worth it. Not only am I now better at C++, but this is also my first GUI-based application! Hooray! I went beyond what I was supposed to do, and I have to say that I&rsquo;m pretty proud of it.</p><p>I do wonder how the rest of the class did on the project. I only got to see their work when I asked them in class, and it&rsquo;s a bit disappointing that no one else created a public repository like mine. I really enjoy reading through them. However, I don&rsquo;t think many people attempted the project, which doesn&rsquo;t bother me too much since creating it wasn&rsquo;t a requirement to get your grades. All other students were free to use the code created by any other student, without losing any grades for it. Additionally, the next assignment is an individual project worth 4x more, so this project was just an introduction to the next one for me.</p><p>I hope you enjoyed reading this post! If you have any questions or if there&rsquo;s something you don&rsquo;t understand, don&rsquo;t hesitate to ask.</p><div class=blog-tags><a href=https://axelvanherle.github.io//tags/programing/>programing</a>&nbsp;
<a href=https://axelvanherle.github.io//tags/howto/>howto</a>&nbsp;
<a href=https://axelvanherle.github.io//tags/story/>story</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2faxelvanherle.github.io%2fpost%2f21-02-23_p2ptcpchatclient%2f&text=Breaking%20Down%20the%20Code%3b%20Creating%20a%20P2P%20Chat%20Client%20with%20C%2b%2b%20and%20QTNetwork.&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2faxelvanherle.github.io%2fpost%2f21-02-23_p2ptcpchatclient%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2faxelvanherle.github.io%2fpost%2f21-02-23_p2ptcpchatclient%2f&title=Breaking%20Down%20the%20Code%3b%20Creating%20a%20P2P%20Chat%20Client%20with%20C%2b%2b%20and%20QTNetwork." target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2faxelvanherle.github.io%2fpost%2f21-02-23_p2ptcpchatclient%2f&title=Breaking%20Down%20the%20Code%3b%20Creating%20a%20P2P%20Chat%20Client%20with%20C%2b%2b%20and%20QTNetwork." target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2faxelvanherle.github.io%2fpost%2f21-02-23_p2ptcpchatclient%2f&title=Breaking%20Down%20the%20Code%3b%20Creating%20a%20P2P%20Chat%20Client%20with%20C%2b%2b%20and%20QTNetwork." target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2faxelvanherle.github.io%2fpost%2f21-02-23_p2ptcpchatclient%2f&description=Breaking%20Down%20the%20Code%3b%20Creating%20a%20P2P%20Chat%20Client%20with%20C%2b%2b%20and%20QTNetwork." target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/post/22-02-23_zerotodnshero/>From Zero to DNS Hero; My Journey Setting Up a Blog with a Custom Domain</a></li><li><a href=/post/20-02-22_howigotthisup/>How i got this website up and running.</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://axelvanherle.github.io/post/20-02-22_howigotthisup/ data-toggle=tooltip data-placement=top title="How i got this website up and running.">&larr; Previous Post</a></li><li class=next><a href=https://axelvanherle.github.io/post/22-02-23_zerotodnshero/ data-toggle=tooltip data-placement=top title="From Zero to DNS Hero; My Journey Setting Up a Blog with a Custom Domain">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:axelvanherle@outlook.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/axelvanherle title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/axelvanherle title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://axelvanherle.github.io/>Axel Vanherle</a>
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://axelvanherle.github.io/>Axel Vanherle</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.101.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://axelvanherle.github.io/js/main.js></script>
<script src=https://axelvanherle.github.io/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://axelvanherle.github.io/js/load-photoswipe.js></script></body></html>